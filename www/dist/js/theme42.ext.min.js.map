{"version":3,"sources":["theme42.ext.js"],"names":["apex","theme42","ext","$","pageId","$v","filterItem","obj","itemId","pItem","searchFieldId","pSearchItem","searchField$","attr","InitSearch","id","itemLabels","itemType","item","item_type","getLabel","obj$","next","text","toLowerCase","getWrapper","parent","each","that$","this","push","node$","txt","search","key","i","current","wrapper$","addClass","length","indexOf","removeClass","filter","val","on","e","which","preventDefault","stopPropagation","filterReportPage","delay","regions","pRegions","displayAsId","pToggleItem","displayAs$","types","Object","keys","refreshReport","regionId","region$","type","show","data","trigger","hide","clearTimeout","setTimeout","change","masterDetailPage","m","primaryKeyItem","filterCountItem","buttons","masterDetailRegions$","noRowSelectedRegion$","bodyContentContainer$","hideRecord","showRecord","scrollToRecord","requireRefresh","ml$","currentRow$","loadRecords","find","animate","scrollTop","position","top","outerHeight","focus","recordContainers$","triggeringElem$","ajax","url","done","refreshReports","updateFilterBadge","filterBadge$","count","append","buildButtons","aButton","bLen","initializePage","keyItem","currentID","window","jQuery"],"mappings":"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","file":"theme42.ext.min.js","sourcesContent":["/*global apex, $v*/\n\n/*!\n theme42.ext.js\n Copyright (c) 2012, 2017 Oracle and/or its affiliates. All rights reserved.\n */\n\n/**\n * @fileOverview\n * The apex.theme42.ext namespace is used to store all theme42 extension functions.\n * We need to check its existence as this file may be part of future APEX release.\n **/\n\nif ( apex.theme42 && !apex.theme42.ext ) {\n\n    apex.theme42.ext = {};\n\n    (function( $, ext ){\n        \"use strict\";\n        // Current Page ID.\n        var pageId = $v( \"pFlowStepId\" );\n\n        /**\n         * Enables a text field item to search labels in another checkbox item.\n         * Currently only checkbox label searching is supported.\n         *\n         * @param {Object} obj with the following option properties:\n         *                 itemId:          The item to be searched.\n         *                 searchFieldId:   Keyword text field that triggers the search.\n         *\n         * @example\n         * apex.theme42.ext.filterItem({\n         *   pItem:        \"P1_COUNTRY\",\n         *   pSearchItem:  \"P1_SEARCH\"\n         * });\n         *\n         * @function filterItem\n         * @memberOf apex.theme42.ext\n         **/\n\n        ext.filterItem = function( obj ) {\n\n            var CL_ACTIVE       = \"js-filter-active\",\n                CL_MATCH        = \"js-filter-match\",\n                TYPE_CB         = \"CHECKBOX_GROUP\",\n                itemId          = obj.pItem,\n                searchFieldId   = obj.pSearchItem,\n                searchField$    = $( \"#\" + searchFieldId );\n\n            searchField$.attr( \"type\", \"search\" );\n\n            // Constructor to store lables to be searched, as well as their jQuery selectors\n            var InitSearch = function( id ){\n                var itemLabels = [],\n                    itemType = apex.item( itemId ).item_type,\n                    i;\n\n                // Different item types may have different markup.\n                // TODO: support more item types, e.g. radioboxes.\n                var getLabel = function( obj$ ){\n                    if ( itemType === TYPE_CB ) {\n                        return obj$.next().text().toLowerCase();\n                    }\n                };\n\n                var getWrapper = function( obj$ ){\n                    if ( itemType === TYPE_CB ) {\n                        return obj$.parent();\n                    }\n                };\n\n                // Gather labels and their nodes\n                $( \"input[name=\" + id + \"]\" ).each(function(){\n                    var that$ = $( this );\n                    itemLabels.push( {\n                        node$: that$,\n                        txt: getLabel( that$ )\n                    });\n                });\n\n                this.search = function( key ) {\n                    var i, current, wrapper$;\n\n                    if ( key ) {\n                        $( \"#\" + id ).addClass( CL_ACTIVE );\n                        for ( i = 0; i < itemLabels.length; i++ ) {\n                            current = itemLabels[i];\n                            wrapper$ = getWrapper( current.node$ );\n                            if ( current.txt.indexOf( key.toLowerCase() ) >= 0 ) {\n                                wrapper$.addClass( CL_MATCH );\n                            } else {\n                                wrapper$.removeClass( CL_MATCH );\n                            }\n                        }\n                    } else {\n                        $( \"#\" + id ).removeClass( CL_ACTIVE );\n                    }\n                };\n            };\n            // supports multiple search on one page.\n            var filter = new InitSearch( itemId );\n\n            // search on page load, if search field already has value.\n            filter.search( searchField$.val() );\n\n            // search-as-you-type\n            searchField$\n                .on( \"keydown\", function( e ){\n                    if ( e.which === 13 ) {\n                        // Enter key won\"t submit the page.\n                        e.preventDefault();\n                    } else if ( e.which === 27 ) {\n                        // ESCAPE key won\"t close dialog.\n                        e.stopPropagation();\n                        // Clears input for browsers that don\"t support type=\"search\"\n                        $( this ).val( \"\" );\n                    }\n                })\n                .on( \"keyup\", function( e ){\n                    filter.search( $( this ).val() );\n                });\n        };\n\n        /**\n         * Filter Report Page is a report page that has a search / filter field(s), one or more reports with different\n         * template, and a radio item to switch between the reports, with only one report displayed at a time.\n         * This function handles the report refreshing when searching and toggling views.\n         * Also please remember to set \"Page Items to Submit\" attribute in each report to use search item name.\n         *\n         * @param {Object} obj with the following properties:\n         *                 pSearchItem:   The text field item to enter keywords.\n         *                 pToggleItem:   The radio group item to switch region\"s visibility\n         *                 pRegions:      An object which has the mapping between returned values\n         *                                of the above radio item and regions\" static IDs.\n         *                                See example below.\n         *\n         * @example:\n         * apex.theme42.ext.filterReportPage({\n         *     pSearchItem: \"P1_SEARCH\",\n         *     pToggleItem: \"P1_DISPLAY_AS\",\n         *     pRegions:    { CARDS:  \"cards_region\",\n         *                    REPORT: \"report_region\" }\n         * });\n         *\n         * @function filterReportPage\n         * @memberOf apex.theme42.ext\n         **/\n\n        ext.filterReportPage = function ( obj ) {\n            var regions         = obj.pRegions,\n                displayAsId     = obj.pToggleItem,\n                displayAs$      = $( \"#\" + displayAsId ),\n                searchField$    = $( \"#\" + obj.pSearchItem ),\n                types           = Object.keys( regions),\n                delay;\n\n            var refreshReport = function() {\n                var type = $v( displayAsId ),\n                    key  =  searchField$.val(),\n                    regionId,\n                    region$,\n                    i;\n\n                for ( i = 0; i < types.length; i++ ) {\n                    regionId = regions[ types[ i ] ];\n                    region$  = $( \"#\" + regionId);\n                    if ( type === types[ i ] ) {\n                        region$.show();\n                        // optimize refresh by comparing stored keyword\n                        if ( region$.data( \"key\" ) !== key ) {\n                            region$.trigger( \"apexrefresh\" ).data( \"key\", key );\n                        }\n                    } else {\n                        region$.hide();\n                    }\n                }\n            };\n\n            // events\n            searchField$\n                .on( \"keydown\", function ( e ) {\n                    if (e.which === 13) {\n                        // prevent ENTER key to submit page\n                        e.preventDefault();\n                    }\n                })\n                .on( \"input\", function () {\n                    clearTimeout( delay );\n                    delay = setTimeout(refreshReport, 250);\n                });\n\n            displayAs$.change( refreshReport );\n\n            // init\n            refreshReport();\n        };\n\n        /**\n         * Master Details Page\n         * TODO: documentation and change parameter to obj.\n         **/\n\n        ext.masterDetailPage = {};\n\n        (function( m ){\n\n            // The name of the Primary Key item. e.g. \"P8_ID\".\n            // it is set on page load using masterDetail.initializePage()\n            var primaryKeyItem,\n            // The hidden item that holds the filter count value.\n                filterCountItem  = \"P\" + pageId + \"_FILTER_COUNT\",\n            // URL of buttons to open modal dialog.\n                buttons = [],\n                LINK_CLASS = \"js-master-row\";\n\n            // Select regions to be refreshed or show/hide.\n            // Details region reports should have \".js-detail-rds\" class\n            // in order to be dynamically refreshed.\n            var masterDetailRegions$  = $( \".js-master-region, .js-detail-rds, .js-detail-region\" ),\n                noRowSelectedRegion$  = $( \".no-record-selected\" ),\n                bodyContentContainer$ = $( \".t-Body-contentInner\" );\n\n            var hideRecord = function() {\n                masterDetailRegions$.hide();\n                noRowSelectedRegion$.show();\n                bodyContentContainer$.addClass( \"center-regions\" );\n            };\n\n            var showRecord = function() {\n                masterDetailRegions$.show();\n                noRowSelectedRegion$.hide();\n                bodyContentContainer$.removeClass( \"center-regions\" );\n            };\n\n            var scrollToRecord = function( id, requireRefresh ) {\n                var ml$ = $( \".\" + LINK_CLASS );\n                if ( ml$[0] ) {\n                    var currentRow$ = ml$.filter( \"[data-id=\\\"\" + id + \"\\\"]\").parent();\n                    if ( requireRefresh ) {\n                        loadRecords( currentRow$.find( \"a.\" + LINK_CLASS ) );\n                    }\n\n                    $( \".search-results\" ).animate(\n                        {\n                            scrollTop: currentRow$.position().top - $( \".search-region\" ).outerHeight()\n                        }, 500 );\n\n                    currentRow$.addClass( \"is-active\" ).focus();\n                }\n            };\n\n            var loadRecords = function( obj ){\n                var recordContainers$ = $( \".\" + LINK_CLASS ).parent(),\n                    triggeringElem$ = $( obj );\n\n                $.ajax({\n                    url: triggeringElem$.data( \"checksum\" )\n                }).done( refreshReports );\n\n                recordContainers$.removeClass( \"is-active\" );\n                triggeringElem$.parent().addClass( \"is-active\" );\n            };\n\n            var refreshReports = function(){\n                // refresh all details reports\n                masterDetailRegions$.trigger( \"apexrefresh\" );\n                // refresh the report used to generate buttons\n                $( \".js-links-region\" ).trigger( \"apexrefresh\" );\n                showRecord();\n            };\n\n            var updateFilterBadge = function(){\n                var filterBadge$,\n                    count = $v( filterCountItem );\n                // Append filter count markup to the Apply Filters button\n                $( \"#apply_filters_btn .t-Button-label\" ).append( \"<span id=\\\"filter_count\\\"></span>\" );\n                filterBadge$  = $( \"#filter_count\" );\n                // Update count\n                if ( count > 0 ) {\n                    filterBadge$.text( count );\n                } else {\n                    filterBadge$.text(\"\");\n                }\n            };\n\n            var buildButtons = function(){\n                var bLen = buttons.length,\n                    aButton,\n                    i;\n                // populate the array with button IDs from the hidden report called \"Edit Links\"\n                $( \"#links_region .js-button-url\" ).each(function(){\n                    buttons.push( $( this ).data( \"button-id\" ) );\n                });\n                // update the \"onclick\" attribute existing buttons to open correct modal dialogs\n                // for the record id selected.\n                for ( i = 0; i < bLen; i++ ) {\n                    aButton = buttons[i];\n                    $( \"#\" + aButton )\n                        .attr( \"onclick\", $( \"[data-button-id=\\\"\" + aButton + \"\\\"]\" )\n                        .attr( \"href\" ) );\n                }\n            };\n\n            var initializePage = function( keyItem ){\n                primaryKeyItem = keyItem;\n                // highlight and scroll to the record if you are coming from another report\n                var currentID = $v( primaryKeyItem );\n                if ( currentID !== \"\" ) {\n                    $( window ).on( \"theme42ready\", function() {\n                        scrollToRecord( currentID );\n                        showRecord();\n                    });\n                } else {\n                    hideRecord();\n                }\n                // click event on row links\n                $( \"body\" ).on(\"click\", \".\" + LINK_CLASS, function( e ) {\n                    loadRecords( this );\n                });\n                // prepare the button URLs to open modal dialogs\n                $( \"#links_region .js-button-url\" ).each(function( e ){\n                    buttons.push( $( this ).data( \"button-id\" ) );\n                });\n            };\n            // public methods to be used in Dynamic Actions.\n            m.initializePage        = initializePage;\n            m.hideRecord            = hideRecord;\n            m.showRecord            = showRecord;\n            m.scrollToRecord        = scrollToRecord;\n            m.refreshReports        = refreshReports;\n            m.buildButtons          = buildButtons;\n            m.updateFilterBadge     = updateFilterBadge;\n\n        })( ext.masterDetailPage );\n\n    })( apex.jQuery, apex.theme42.ext );\n\n}"]}